# Logrotate configuration for Ruuvi Sensor Service
# This file should be copied to /etc/logrotate.d/ruuvi-sensor during installation

/opt/ruuvi-sensor-service/logs/*.log {
    # Rotate daily
    daily
    
    # Keep 7 days of logs
    rotate 7
    
    # Compress old logs
    compress
    delaycompress
    
    # Don't rotate if log is empty
    notifempty
    
    # Don't error if log file is missing
    missingok
    
    # Copy and truncate instead of moving (safer for active processes)
    copytruncate
    
    # Set ownership for rotated files
    su ruuvi ruuvi
    
    # Set permissions for rotated files
    create 644 ruuvi ruuvi
    
    # Run post-rotation script
    postrotate
        # Send SIGHUP to daemon to reopen log files if running
        if systemctl is-active --quiet ruuvi-sensor; then
            systemctl reload ruuvi-sensor || true
        fi
    endscript
}

# Separate configuration for performance logs (keep longer)
/opt/ruuvi-sensor-service/logs/performance.log {
    weekly
    rotate 4
    compress
    delaycompress
    notifempty
    missingok
    copytruncate
    su ruuvi ruuvi
    create 644 ruuvi ruuvi
}

# Separate configuration for error logs (keep longer)
/opt/ruuvi-sensor-service/logs/*error*.log {
    weekly
    rotate 8
    compress
    delaycompress
    notifempty
    missingok
    copytruncate
    su ruuvi ruuvi
    create 644 ruuvi ruuvi
}